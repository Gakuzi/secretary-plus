<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инструкция по настройке Секретарь+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="setup-guide.css">
</head>
<body class="bg-gray-900 text-gray-200 font-sans">
    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-gray-800 p-6 border-r border-gray-700 fixed top-0 left-0 h-full overflow-y-auto">
            <h1 class="text-xl font-bold text-white mb-8">Мастер Настройки</h1>
            <nav>
                <ul class="space-y-2" id="wizard-nav">
                    <li><a href="#introduction" class="nav-link active" data-step="0">Введение</a></li>
                    <li><a href="#supabase-setup" class="nav-link" data-step="1">1. Настройка Supabase</a></li>
                    <li><a href="#google-cloud-setup" class="nav-link" data-step="2">2. Настройка Google Cloud</a></li>
                    <li><a href="#gemini-setup" class="nav-link" data-step="3">3. Настройка Gemini API</a></li>
                    <li><a href="#final-step" class="nav-link" data-step="4">4. Завершение</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="ml-64 p-8 md:p-12 w-full">
            <div class="max-w-4xl mx-auto">
                
                <!-- Introduction -->
                <section id="introduction" class="wizard-step">
                    <h2 class="section-title">Введение</h2>
                    <p>Добро пожаловать в руководство по настройке «Секретарь+»! Это приложение использует несколько внешних сервисов Google для своей работы. Следуйте этой инструкции шаг за шагом, чтобы получить все необходимые ключи и настроить приложение.</p>
                    <p>На каждом шаге вы можете вставлять полученные ключи в поля ниже, чтобы не потерять их. Эти данные никуда не отправляются и хранятся только на этой странице.</p>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button next-button" data-next="1">Начать настройку</button>
                    </footer>
                </section>

                <!-- Supabase Setup -->
                <section id="supabase-setup" class="wizard-step" style="display: none;">
                    <h2 class="section-title">1. Настройка Supabase</h2>
                    <p class="mb-6">Supabase используется как безопасная база данных и сервис аутентификации. Если вы включите его, пользователи смогут входить через Google, а их контакты и файлы будут синхронизироваться для быстрого доступа.</p>

                    <div class="step">
                        <h3 class="step-title">Шаг 1.1: Создание проекта</h3>
                        <ol>
                            <li><a href="https://supabase.com/dashboard/projects" target="_blank">Откройте панель управления Supabase</a> и нажмите <strong>"New project"</strong>.</li>
                            <li>Придумайте имя проекта, сгенерируйте и сохраните надежный пароль от базы данных.</li>
                            <li>Выберите регион и нажмите <strong>"Create new project"</strong>.</li>
                        </ol>
                    </div>

                    <div class="step">
                        <h3 class="step-title">Шаг 1.2: Выполнение SQL-скрипта</h3>
                        <ol>
                            <li>В меню проекта выберите <strong>SQL Editor</strong>, затем <strong>"+ New query"</strong>.</li>
                            <li>Скопируйте и вставьте весь SQL-скрипт ниже, затем нажмите <strong>"RUN"</strong>.</li>
                        </ol>
                        <div class="code-block">
                            <pre><code id="sql-script-content">-- 1. Создаем таблицу для контактов
CREATE TABLE public.contacts (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  source TEXT NOT NULL,
  source_id TEXT,
  display_name TEXT,
  email TEXT,
  phone TEXT,
  avatar_url TEXT,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  UNIQUE(user_id, source, source_id)
);
-- 2. Создаем таблицу для файлов
CREATE TABLE public.files (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  source TEXT NOT NULL,
  source_id TEXT,
  name TEXT NOT NULL,
  mime_type TEXT,
  url TEXT,
  icon_link TEXT,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  UNIQUE(user_id, source, source_id)
);
-- 3. Включаем Row Level Security (RLS)
ALTER TABLE public.contacts ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.files ENABLE ROW LEVEL SECURITY;
-- 4. Создаем политику для контактов
CREATE POLICY "Allow users to manage their own contacts"
ON public.contacts FOR ALL
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);
-- 5. Создаем политику для файлов
CREATE POLICY "Allow users to manage their own files"
ON public.files FOR ALL
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);</code></pre>
                            <button class="copy-button" data-copy-target="sql-script-content">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                                <span class="copy-text">Копировать</span>
                            </button>
                        </div>
                        <p class="note"><strong>Почему это важно?</strong> Этот скрипт включает <strong>Row Level Security (RLS)</strong> — критически важную функцию, которая гарантирует, что каждый пользователь видит только свои данные.</p>
                    </div>

                    <div class="step">
                        <h3 class="step-title">Шаг 1.3: Получение ключей Supabase</h3>
                        <ol>
                            <li><a href="https://supabase.com/dashboard/project/_/settings/api" target="_blank">Откройте настройки API</a> вашего проекта.</li>
                            <li>Скопируйте <strong>Project URL</strong> и <strong>anon public key</strong>. Вставьте их в поля ниже и в настройки приложения.</li>
                        </ol>
                        <div class="input-group">
                            <label for="supabase-url-input">Project URL</label>
                            <div class="input-wrapper">
                                <input id="supabase-url-input" type="text" placeholder="https://<id>.supabase.co" readonly>
                                <button class="paste-button" data-paste-target="supabase-url-input">Вставить</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="supabase-key-input">Anon Public Key</label>
                            <div class="input-wrapper">
                                <input id="supabase-key-input" type="text" placeholder="Ваш anon public key" readonly>
                                <button class="paste-button" data-paste-target="supabase-key-input">Вставить</button>
                            </div>
                        </div>
                    </div>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button back-button" data-back="0">Назад</button>
                        <button class="wizard-nav-button next-button" data-next="2">Далее</button>
                    </footer>
                </section>

                <!-- Google Cloud Setup -->
                <section id="google-cloud-setup" class="wizard-step" style="display: none;">
                    <h2 class="section-title">2. Настройка Google Cloud</h2>
                    <p class="mb-6">Вам нужен проект в Google Cloud, чтобы разрешить приложению доступ к API Календаря, Диска и Контактов.</p>

                    <div class="step">
                        <h3 class="step-title">Шаг 2.1: Проект и экран согласия</h3>
                        <ol>
                            <li><a href="https://console.cloud.google.com/projectcreate" target="_blank">Создайте новый проект</a> в Google Cloud Console.</li>
                            <li>Перейдите в <a href="https://console.cloud.google.com/apis/credentials/consent" target="_blank"><strong>OAuth consent screen</strong></a>.</li>
                            <li>Выберите <strong>External</strong> и нажмите "Create". Заполните обязательные поля. На шаге "Test users" добавьте свой Google аккаунт.</li>
                            <li>После создания экрана согласия, нажмите <strong>"Publish App"</strong>.</li>
                        </ol>
                    </div>

                    <div class="step">
                        <h3 class="step-title">Шаг 2.2: Включение API</h3>
                        <ol>
                            <li>Перейдите в <a href="https://console.cloud.google.com/apis/library" target="_blank"><strong>библиотеку API</strong></a>.</li>
                            <li>Найдите и включите (Enable) следующие <strong>8 API</strong>:
                                <ul class="list-disc list-inside mt-2 grid grid-cols-2 gap-x-4">
                                   <li><a href="https://console.cloud.google.com/apis/library/calendar-json.googleapis.com" target="_blank">Google Calendar API</a></li>
                                    <li><a href="https://console.cloud.google.com/apis/library/people.googleapis.com" target="_blank">Google People API</a></li>
                                    <li><a href="https://console.cloud.google.com/apis/library/drive.googleapis.com" target="_blank">Google Drive API</a></li>
                                    <li><a href="https://console.cloud.google.com/apis/library/docs.googleapis.com" target="_blank">Google Docs API</a></li>
                                    <li><a href="https://console.cloud.google.com/apis/library/sheets.googleapis.com" target="_blank">Google Sheets API</a></li>
                                    <li><a href="https://console.cloud.google.com/apis/library/tasks.googleapis.com" target="_blank">Google Tasks API</a></li>
                                    <li><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank">Gmail API</a></li>
                                    <li><a href="https://console.cloud.google.com/apis/library/cloudidentity.googleapis.com" target="_blank">Cloud Identity API</a></li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <div class="step">
                        <h3 class="step-title">Шаг 2.3: Создание OAuth 2.0 Client ID</h3>
                        <ol>
                            <li>Перейдите в <a href="https://console.cloud.google.com/apis/credentials" target="_blank"><strong>Credentials</strong></a>, нажмите <strong>+ CREATE CREDENTIALS &gt; OAuth client ID</strong>.</li>
                            <li>Выберите тип <strong>Web application</strong>.</li>
                            <li>Для <strong>входа через Supabase</strong> (рекомендуется):
                                <ul>
                                    <li>Скопируйте Redirect URI из настроек Google-провайдера в Supabase.</li>
                                    <li>Вставьте его в поле <strong>"Authorized redirect URIs"</strong> в Google Cloud.</li>
                                    <li>Создайте и скопируйте Client ID и Client Secret в Supabase.</li>
                                </ul>
                            </li>
                             <li>Для <strong>прямого входа в Google</strong> (если Supabase отключен):
                                <ul>
                                    <li>В <strong>"Authorized JavaScript origins"</strong> добавьте URL, где размещено ваше приложение.</li>
                                    <li>Создайте и скопируйте только <strong>Client ID</strong>.</li>
                                </ul>
                            </li>
                        </ol>
                         <div class="input-group">
                            <label for="google-id-input">Google Client ID (для прямого входа)</label>
                            <div class="input-wrapper">
                                <input id="google-id-input" type="text" placeholder="Ваш Google Client ID" readonly>
                                <button class="paste-button" data-paste-target="google-id-input">Вставить</button>
                            </div>
                        </div>
                    </div>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button back-button" data-back="1">Назад</button>
                        <button class="wizard-nav-button next-button" data-next="3">Далее</button>
                    </footer>
                </section>
                
                <!-- Gemini Setup -->
                <section id="gemini-setup" class="wizard-step" style="display: none;">
                    <h2 class="section-title">3. Настройка Gemini API</h2>
                    <p class="mb-6">Gemini — это модель искусственного интеллекта от Google, которая является "мозгом" ассистента. Вам нужен API-ключ для отправки запросов.</p>
                    <div class="step">
                         <ol>
                            <li><a href="https://aistudio.google.com/app/apikey" target="_blank">Откройте Google AI Studio</a>.</li>
                            <li>Нажмите <strong>"Create API key in new project"</strong>.</li>
                            <li>Скопируйте сгенерированный ключ.</li>
                            <li>Вставьте его в поле ниже и в настройки приложения.</li>
                        </ol>
                        <p class="note">Ваш ключ хранится только локально в вашем браузере и никуда не передается.</p>
                         <div class="input-group">
                            <label for="gemini-key-input">Gemini API Key</label>
                            <div class="input-wrapper">
                                <input id="gemini-key-input" type="text" placeholder="Ваш Gemini API Key" readonly>
                                <button class="paste-button" data-paste-target="gemini-key-input">Вставить</button>
                            </div>
                        </div>
                    </div>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button back-button" data-back="2">Назад</button>
                        <button class="wizard-nav-button next-button" data-next="4">Далее</button>
                    </footer>
                </section>
                
                 <!-- Final -->
                <section id="final-step" class="wizard-step" style="display: none;">
                    <h2 class="section-title">4. Завершение</h2>
                    <p>Поздравляем! Вы получили и ввели все необходимые ключи. Теперь откройте настройки приложения «Секретарь+» и вставьте их в соответствующие поля на вкладках «Подключения» и «API Ключи».</p>
                    <p>После сохранения настроек приложение будет полностью готово к работе. Вы можете войти в свой аккаунт Google и начать использовать ассистента.</p>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button back-button" data-back="3">Назад</button>
                        <button class="wizard-nav-button next-button" onclick="window.close()">Закрыть</button>
                    </footer>
                </section>

            </div>
        </main>
    </div>
    <script src="setup-guide.js"></script>
</body>
</html>