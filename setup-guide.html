<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инструкция по настройке Секретарь+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="setup-guide.css">
</head>
<body class="bg-gray-900 text-gray-200 font-sans">
    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-gray-800 p-6 border-r border-gray-700 fixed top-0 left-0 h-full overflow-y-auto">
            <h1 class="text-xl font-bold text-white mb-8">Мастер Настройки</h1>
            <nav>
                <ul class="space-y-2" id="wizard-nav">
                    <li><a href="#introduction" class="nav-link active" data-step="0">Введение</a></li>
                    <li><a href="#auth-choice" class="nav-link" data-step="1">1. Выбор способа</a></li>
                    <li><a href="#supabase-setup" class="nav-link" data-step="2">2. Настройка Supabase</a></li>
                    <li><a href="#google-cloud-setup" class="nav-link" data-step="3">3. Настройка Google Cloud</a></li>
                    <li><a href="#gemini-setup" class="nav-link" data-step="4">4. Настройка Gemini API</a></li>
                    <li><a href="#final-step" class="nav-link" data-step="5">5. Завершение</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="ml-64 p-8 md:p-12 w-full">
            <div class="max-w-4xl mx-auto">
                
                <!-- Introduction -->
                <section id="introduction" class="wizard-step">
                    <h2 class="section-title">Введение</h2>
                    <p>Добро пожаловать в руководство по настройке «Секретарь+»! Это приложение использует несколько внешних сервисов Google для своей работы. Следуйте этой инструкции шаг за шагом, чтобы получить все необходимые ключи и настроить приложение.</p>
                    <p>На каждом шаге вы можете вставлять полученные ключи в поля ниже, чтобы не потерять их. Эти данные никуда не отправляются и хранятся только на этой странице.</p>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button next-button" data-next="1">Начать настройку</button>
                    </footer>
                </section>
                
                 <!-- Auth Choice -->
                <section id="auth-choice" class="wizard-step" style="display: none;">
                    <h2 class="section-title">1. Выбор способа аутентификации</h2>
                    <p class="mb-6">Приложение поддерживает два способа подключения к сервисам Google. Выберите один из них. <strong>Рекомендуется использовать Supabase.</strong></p>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="choice-card" data-choice="supabase">
                            <h3 class="choice-title">Supabase (Рекомендуется)</h3>
                            <p class="choice-description">Использует Supabase для безопасной аутентификации и хранения данных (контакты, файлы). Это обеспечивает лучшую производительность и функциональность, включая синхронизацию.</p>
                            <ul class="choice-features">
                                <li>✅ Безопасный вход через Google</li>
                                <li>✅ Синхронизация контактов и файлов</li>
                                <li>✅ Быстрый поиск по данным</li>
                            </ul>
                        </div>
                         <div class="choice-card" data-choice="direct">
                            <h3 class="choice-title">Прямое подключение Google</h3>
                            <p class="choice-description">Простой способ, подключающий приложение напрямую к Google API без использования базы данных. Функции синхронизации и быстрого поиска по контактам будут недоступны.</p>
                             <ul class="choice-features">
                                <li>✅ Простая настройка</li>
                                <li>❌ Без синхронизации данных</li>
                                <li>❌ Поиск только по Google Drive</li>
                            </ul>
                        </div>
                    </div>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button back-button" data-back="0">Назад</button>
                    </footer>
                </section>

                <!-- Supabase Setup -->
                <section id="supabase-setup" class="wizard-step" style="display: none;">
                    <h2 class="section-title">2. Настройка Supabase</h2>
                    <p class="mb-6">Supabase используется как безопасная база данных и сервис аутентификации. Если вы включите его, пользователи смогут входить через Google, а их контакты и файлы будут синхронизироваться для быстрого доступа.</p>

                    <div class="step">
                        <h3 class="step-title">Шаг 2.1: Создание проекта</h3>
                        <ol>
                            <li><a href="https://supabase.com/dashboard/projects" target="_blank" rel="noopener noreferrer">Откройте панель управления Supabase</a> и нажмите <strong>"New project"</strong>.</li>
                            <li>Придумайте имя проекта, сгенерируйте и сохраните надежный пароль от базы данных.</li>
                            <li>Выберите регион и нажмите <strong>"Create new project"</strong>.</li>
                        </ol>
                    </div>

                    <div class="step">
                        <h3 class="step-title">Шаг 2.2: Выполнение SQL-скрипта</h3>
                        <ol>
                            <li>В меню проекта выберите <strong>SQL Editor</strong>, затем <strong>"+ New query"</strong>.</li>
                            <li>Скопируйте и вставьте весь SQL-скрипт ниже, затем нажмите <strong>"RUN"</strong>.</li>
                        </ol>
                        <div class="code-block">
                            <pre><code id="sql-script-content">-- 1. Создаем таблицу для контактов
CREATE TABLE public.contacts (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  source TEXT NOT NULL,
  source_id TEXT,
  display_name TEXT,
  email TEXT,
  phone TEXT,
  avatar_url TEXT,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  UNIQUE(user_id, source, source_id)
);

-- 2. Создаем таблицу для файлов с расширенными полями
CREATE TABLE public.files (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  source TEXT NOT NULL,
  source_id TEXT,
  name TEXT NOT NULL,
  mime_type TEXT,
  url TEXT,
  icon_link TEXT,
  created_time TIMESTAMPTZ,
  modified_time TIMESTAMPTZ,
  viewed_by_me_time TIMESTAMPTZ,
  size BIGINT,
  owner TEXT,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  UNIQUE(user_id, source, source_id)
);

-- 3. Создаем таблицу для заметок
CREATE TABLE public.notes (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  title TEXT,
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- 4. Создаем таблицу для событий календаря (кеш)
CREATE TABLE public.calendar_events (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
    source_id TEXT NOT NULL,
    title TEXT,
    description TEXT,
    start_time TIMESTAMPTZ,
    end_time TIMESTAMPTZ,
    event_link TEXT,
    meet_link TEXT,
    synced_at TIMESTAMPTZ DEFAULT now(),
    UNIQUE(user_id, source_id)
);

-- 5. Создаем таблицу для задач (кеш)
CREATE TABLE public.tasks (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
    source_id TEXT NOT NULL,
    title TEXT,
    notes TEXT,
    due_date TIMESTAMPTZ,
    status TEXT,
    synced_at TIMESTAMPTZ DEFAULT now(),
    UNIQUE(user_id, source_id)
);

-- 6. Создаем таблицу для долговременной памяти чата
CREATE TABLE public.chat_memory (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
    summary TEXT NOT NULL,
    keywords TEXT[],
    created_at TIMESTAMPTZ DEFAULT now()
);


-- 7. Включаем Row Level Security (RLS) для всех таблиц
ALTER TABLE public.contacts ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.files ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.notes ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.calendar_events ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tasks ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.chat_memory ENABLE ROW LEVEL SECURITY;


-- 8. Создаем политики безопасности
CREATE POLICY "Allow users to manage their own contacts" ON public.contacts FOR ALL USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Allow users to manage their own files" ON public.files FOR ALL USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Allow users to manage their own notes" ON public.notes FOR ALL USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Allow users to manage their own calendar events" ON public.calendar_events FOR ALL USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Allow users to manage their own tasks" ON public.tasks FOR ALL USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Allow users to manage their own chat memory" ON public.chat_memory FOR ALL USING (auth.uid() = user_id) WITH CHECK (auth.uid() = user_id);
</code></pre>
                            <button class="copy-button" data-copy-target="sql-script-content">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                                <span class="copy-text">Копировать</span>
                            </button>
                        </div>
                        <p class="note"><strong>Почему это важно?</strong> Этот скрипт включает <strong>Row Level Security (RLS)</strong> — критически важную функцию, которая гарантирует, что каждый пользователь видит только свои данные.</p>
                    </div>

                    <div class="step">
                        <h3 class="step-title">Шаг 2.3: Получение ключей Supabase</h3>
                        <ol>
                             <li>В меню проекта выберите <strong>Project Settings</strong> (значок шестеренки) &gt; <strong>API</strong>.</li>
                            <li>Скопируйте <strong>Project URL</strong> и <strong>anon public key</strong>. Вставьте их в поля ниже и в настройки приложения.</li>
                        </ol>
                        <div class="input-group">
                            <label for="supabase-url-input">Project URL</label>
                            <div class="input-wrapper">
                                <input id="supabase-url-input" type="text" placeholder="https://<id>.supabase.co" readonly>
                                <button class="paste-button" data-paste-target="supabase-url-input">Вставить</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="supabase-key-input">Anon Public Key</label>
                            <div class="input-wrapper">
                                <input id="supabase-key-input" type="text" placeholder="Ваш anon public key" readonly>
                                <button class="paste-button" data-paste-target="supabase-key-input">Вставить</button>
                            </div>
                        </div>
                    </div>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button back-button" data-back="1">Назад</button>
                        <button class="wizard-nav-button next-button" data-next="3">Далее</button>
                    </footer>
                </section>

                <!-- Google Cloud Setup -->
                <section id="google-cloud-setup" class="wizard-step" style="display: none;">
                    <h2 class="section-title">3. Настройка Google Cloud</h2>
                    <p class="mb-6">Вам нужен проект в Google Cloud, чтобы разрешить приложению доступ к API Календаря, Диска и Контактов.</p>

                    <div class="step">
                        <h3 class="step-title">Шаг 3.1: Проект и экран согласия</h3>
                        <ol>
                            <li><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener noreferrer">Создайте новый проект</a> в Google Cloud Console (или выберите существующий).</li>
                            <li>Перейдите в <a href="https://console.cloud.google.com/apis/credentials/consent" target="_blank" rel="noopener noreferrer"><strong>APIs & Services &gt; OAuth consent screen</strong></a>.</li>
                            <li>Выберите <strong>External</strong> и нажмите "Create". Заполните обязательные поля (имя приложения, email).</li>
                            <li>На шаге "Scopes" ничего не добавляйте.</li>
                            <li>На шаге "Test users" добавьте свой Google аккаунт, с которого будете входить в приложение.</li>
                            <li>Вернитесь на страницу OAuth consent screen и нажмите <strong>"Publish App"</strong>, чтобы приложение стало доступно.</li>
                        </ol>
                    </div>

                    <div class="step">
                        <h3 class="step-title">Шаг 3.2: Включение API</h3>
                        <p>Перейдите в <a href="https://console.cloud.google.com/apis/library" target="_blank" rel="noopener noreferrer"><strong>библиотеку API</strong></a> и включите (Enable) следующие 8 API:</p>
                        <ul class="list-disc list-inside mt-2 grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2">
                           <li><a href="https://console.cloud.google.com/apis/library/calendar-json.googleapis.com" target="_blank" rel="noopener noreferrer">Google Calendar API</a></li>
                            <li><a href="https://console.cloud.google.com/apis/library/people.googleapis.com" target="_blank" rel="noopener noreferrer">Google People API</a></li>
                            <li><a href="https://console.cloud.google.com/apis/library/drive.googleapis.com" target="_blank" rel="noopener noreferrer">Google Drive API</a></li>
                            <li><a href="https://console.cloud.google.com/apis/library/docs.googleapis.com" target="_blank" rel="noopener noreferrer">Google Docs API</a></li>
                            <li><a href="https://console.cloud.google.com/apis/library/sheets.googleapis.com" target="_blank" rel="noopener noreferrer">Google Sheets API</a></li>
                            <li><a href="https://console.cloud.google.com/apis/library/tasks.googleapis.com" target="_blank" rel="noopener noreferrer">Google Tasks API</a></li>
                            <li><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener noreferrer">Gmail API</a> (для отправки и чтения писем)</li>
                            <li><a href="https://console.cloud.google.com/apis/library/cloudidentity.googleapis.com" target="_blank" rel="noopener noreferrer">Cloud Identity API</a></li>
                        </ul>
                    </div>

                    <div class="step">
                        <h3 class="step-title">Шаг 3.3: Создание OAuth 2.0 Client ID</h3>
                        <ol>
                            <li>Перейдите в <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener noreferrer"><strong>Credentials</strong></a>, нажмите <strong>+ CREATE CREDENTIALS &gt; OAuth client ID</strong>.</li>
                            <li>Выберите тип <strong>Web application</strong>.</li>
                        </ol>
                        
                        <div id="google-supabase-instructions" style="display: none;">
                            <p class="mt-4"><strong>Инструкция для Supabase:</strong></p>
                            <ol>
                                <li>В панели Supabase перейдите в <strong>Authentication &gt; Providers &gt; Google</strong>. Скопируйте <strong>Redirect URI</strong>.</li>
                                <li>Вернитесь в Google Cloud. Вставьте скопированный URI в поле <strong>"Authorized redirect URIs"</strong>.</li>
                                <li>Нажмите <strong>CREATE</strong>. Скопируйте <strong>Client ID</strong> и <strong>Client Secret</strong>.</li>
                                <li>Вернитесь в Supabase и вставьте их в соответствующие поля, затем нажмите <strong>Save</strong>.</li>
                            </ol>
                        </div>
                        
                        <div id="google-direct-instructions" style="display: none;">
                             <p class="mt-4"><strong>Инструкция для прямого подключения:</strong></p>
                             <ol>
                                <li>В поле <strong>"Authorized JavaScript origins"</strong> добавьте URL, где размещено ваше приложение (например, `https://username.github.io`).</li>
                                 <li>В поле <strong>"Authorized redirect URIs"</strong> также добавьте этот URL.</li>
                                <li>Нажмите <strong>CREATE</strong>. Скопируйте только <strong>Client ID</strong> и вставьте его в поле ниже.</li>
                            </ol>
                            <div class="input-group">
                                <label for="google-id-input">Google Client ID</label>
                                <div class="input-wrapper">
                                    <input id="google-id-input" type="text" placeholder="Ваш Google Client ID" readonly>
                                    <button class="paste-button" data-paste-target="google-id-input">Вставить</button>
                                </div>
                            </div>
                        </div>
                    </div>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button back-button" data-back="1">Назад</button>
                        <button class="wizard-nav-button next-button" data-next="4">Далее</button>
                    </footer>
                </section>
                
                <!-- Gemini Setup -->
                <section id="gemini-setup" class="wizard-step" style="display: none;">
                    <h2 class="section-title">4. Настройка Gemini API</h2>
                    <p class="mb-6">Gemini — это модель искусственного интеллекта от Google, которая является "мозгом" ассистента. Вам нужен API-ключ для отправки запросов.</p>
                    <div class="step">
                         <ol>
                            <li><a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">Откройте Google AI Studio</a>.</li>
                            <li>Нажмите <strong>"Create API key in new project"</strong>.</li>
                            <li>Скопируйте сгенерированный ключ.</li>
                            <li>Вставьте его в поле ниже и в настройки приложения.</li>
                        </ol>
                        <p class="note">Ваш ключ хранится только локально в вашем браузере и никуда не передается.</p>
                         <div class="input-group">
                            <label for="gemini-key-input">Gemini API Key</label>
                            <div class="input-wrapper">
                                <input id="gemini-key-input" type="text" placeholder="Ваш Gemini API Key" readonly>
                                <button class="paste-button" data-paste-target="gemini-key-input">Вставить</button>
                            </div>
                        </div>
                    </div>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button back-button" data-back="3">Назад</button>
                        <button class="wizard-nav-button next-button" data-next="5">Далее</button>
                    </footer>
                </section>
                
                 <!-- Final -->
                <section id="final-step" class="wizard-step" style="display: none;">
                    <h2 class="section-title">5. Завершение</h2>
                    <p>Поздравляем! Вы получили все необходимые ключи. Теперь откройте настройки приложения «Секретарь+» и вставьте их в соответствующие поля.</p>
                    <div id="final-supabase-instructions" style="display: none;">
                        <ol class="list-decimal list-inside space-y-2 mt-4">
                            <li>Включите переключатель <strong>"База данных и Аутентификация"</strong>.</li>
                            <li>Вставьте <strong>Project URL</strong> и <strong>Anon Key</strong> из <a href="#supabase-setup" class="nav-link-inline" data-step="2">Шага 2</a>.</li>
                            <li>На вкладке "API Ключи" вставьте <strong>Gemini API Key</strong> из <a href="#gemini-setup" class="nav-link-inline" data-step="4">Шага 4</a>.</li>
                        </ol>
                    </div>
                     <div id="final-direct-instructions" style="display: none;">
                        <ol class="list-decimal list-inside space-y-2 mt-4">
                            <li>Выключите переключатель <strong>"База данных и Аутентификация"</strong>.</li>
                            <li>Вставьте <strong>Google Client ID</strong> из <a href="#google-cloud-setup" class="nav-link-inline" data-step="3">Шага 3</a>.</li>
                             <li>На вкладке "API Ключи" вставьте <strong>Gemini API Key</strong> из <a href="#gemini-setup" class="nav-link-inline" data-step="4">Шага 4</a>.</li>
                        </ol>
                    </div>
                    <p class="mt-4">После сохранения настроек приложение будет полностью готово к работе. Вы можете войти в свой аккаунт Google и начать использовать ассистента.</p>
                     <footer class="wizard-footer">
                        <button class="wizard-nav-button back-button" data-back="4">Назад</button>
                        <button class="wizard-nav-button next-button" onclick="window.close()">Закрыть</button>
                    </footer>
                </section>

            </div>
        </main>
    </div>
    <script src="setup-guide.js"></script>
</body>
</html>